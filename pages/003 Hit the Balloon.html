<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>003 Hit the Balloon</title>
    <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.18.1/build/cssreset/cssreset-min.css">
    <style>

        body,html {
            width: 100%;
            height: 100%;
            background: url("./src/003/bg.jpg") no-repeat;
            background-size: cover;
            overflow: hidden;
            user-select: none;
        }
        h1 {
            font-weight: bold;
            font-size: 30px;
            color: #f8f8f8;
        }
        h1 span {
            color: #ff0000;
        }
        .confirmBox{
            background-color: #aaaaaa;
            border: 1px solid darkgoldenrod;
            min-width: 700px;
            min-height: 400px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
        }
        .confirmBox h2{
            font-size: 25px;
            text-align: center;
            margin-top: 10%;
        }
        .gameOn{
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            margin-top: 5%;
            font-size: 20px;
        }
        input{
            padding: 0 20px;
            margin: 0 10px;
            border: 1px solid #008800;
        }
        .recBox{
            margin-top: 5%;
            display: flex;
            justify-content: center;
        }
        .finalScore{
            display: none;
            margin-top: 10%;
        }
        .finalScore h1{
            text-align: center;
        }
        .balloon{
            position: absolute;
            background: url("./src/003/balloon.png") no-repeat;
            top:100%;  /*记得改回100%*/
            width: 82px;
            height: 115px;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>Your Score: <span class="score">0</span></h1>
<h1>Time Left: <span id="timer">30</span>s</h1>
<div class="confirmBox">
    <h2>Let's Get Started!</h2>
    <div class="gameOn">
        <label>
            Level:
            <select name="level" id="level">
                <option value="1">easy</option>
                <option value="3">medium</option>
                <option value="6">hard</option>
                <option value="9">hell</option>
            </select>
        </label>
        <input type="submit" id="yes" value="GO!">
    </div>
    <div class="recBox"><input type="submit" id="rec" value="Records"></div>
    <div class="finalScore">
        <h1>Your final score is <span class="score"></span></h1>
    </div>
</div>
<script src="./../bower_components/jquery/dist/jquery.min.js"></script>
<script>
    var point,select;
    //随机一个整数random
    function Rnd(value){
        this.value = value;
    }
    Rnd.prototype.floor = function(){
        return Math.floor(Math.random()*this.value)
    };
    Rnd.prototype.ceil = function(){
        return Math.ceil(Math.random()*this.value)
    };


    //球的值
    const balloons = [
        {
            index:0,
            score:1,
            bgX:'0px',
            speed:1
        },{
            index:1,
            score:2,
            bgX:'-81px',
            speed:1.5
        },{
            index:2,
            score:3,
            bgX:'-162px',
            speed:2
        },{
            index:3,
            score:4,
            bgX:'-244px',
            speed:2.5

        },{
            index:4,
            score:5,
            bgX:'-324px',
            speed:3
        },{
            index:5,
            score:6,
            bgX:'-405px',
            speed:4
        },{
            index:6,
            score:7,
            bgX:'-487px',
            speed:5
        },{
            index:7,
            score:8,
            bgX:'-569px',
            speed:6
        },{
            index:8,
            score:function(v){
                v/=2;
                v = Math.ceil(v);
                return v;
            },
            bgX:'-651px',
            speed:(function(){
                return (Math.random()*3+3).toFixed(1)
            })()
        },{
            index:9,
            score:function(v){
                return v*2;
            },
            bgX:'-732px',
            speed:(function(){
                return (Math.random()*3+3).toFixed(1);
            })()
        },{
            index:10,
            score:function(){
                return 0;
            },
            bgX:'-812px',
            speed:(function(){
                return (Math.random()*6).toFixed(1);
            })()
        },{
            index:11,
            score:function(v){
                var rnd = Math.floor(Math.random()*11);
                var bs = balloons[rnd].score;
                if (typeof bs === 'number'){
                    v += 2*bs;
                    return v
                } else {
                    return bs(v);
                }
            },
            bgX:'-894px',
            speed:(function(){
                return (Math.random()*6).toFixed(1);
            })()
        }
    ];

    //球
    function Balloon(){
        var rnd = new Rnd(12);
        var n = rnd.floor();  //原来用 this.n

        this.b = balloons[n]; //原来用 this.n
        this.left = Math.random()*100 + '%';
        this.speed = this.b.speed;

//        var score = this.score();
        this.init();

//        this.move();
    }
    //初始化气球
    Balloon.prototype.init = function(){
//        console.log(this.b);
        var that = this;
        this.dom = $('<div></div>').addClass('balloon').css({
            'background-position-x':this.b.bgX,
            'left':this.left
        }).appendTo('body');
        this.up();

        this.dom.on('click',function(){
            point = that.score(point);  //记得一定要赋值
            $('.score').text(point);
            that.pop();
        })
    };
    //炸
    Balloon.prototype.pop = function(){
        clearInterval(this.timer);
        this.dom.remove();
    };
    //飞
    Balloon.prototype.up = function(){
        var speed = this.speed;
        var that = this;
        this.timer = setInterval(function () {
            that.dom.css({
                top:function(i,v){
                    return (parseInt(v)-speed*select)+'px'
                }
            });
            if (parseInt(that.dom.css('top')) < 0){
                that.pop();
                clearInterval(this.timer)
            }
        },20)
    };
    //分
    Balloon.prototype.score = function(value){
        if (typeof this.b.score === 'function'){
            value = this.b.score(value);
            return value
        } else {
            value += this.b.score;
            return value
        }
    };

    //循环计数
    $('#yes').on('click',function(){
        $('.confirmBox').hide();
        var count = 0;
        point = 0;
        select = $('#level').find('option:selected').val();
//        console.log(select);
        var clock = 30;

        var timer = setInterval(function(){
            count++;
            if (count%2===0){
                clock--;
                $('#timer').text(clock);
            }
            if (clock ===0){
                clearInterval(timer);
                setTimeout(function () {
                    $('.balloon').remove()
                },200);
                $('.finalScore').show();
                $('.confirmBox').show();
            }
            new Balloon();
        },500);
    }).one('click',function(){
        $('.confirmBox h2').text("Let's Play Again!!")
    });
    //点击后以后变字

    //todo localStorage储存数据，记得用json格式
</script>
</body>
</html>